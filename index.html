<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Contagem de Material – Grupo Coqueiro Verde</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --preto: #000;
      --branco: #fff;
      --cinza-claro: #f5f5f5;
      --cinza: #ccc;
      --cinza-escuro: #333;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: var(--cinza-claro);
      margin: 0;
      padding: 20px;
      color: var(--preto);
    }

    .container {
      max-width: 960px;
      margin: auto;
      background-color: var(--branco);
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h1, h2 {
      text-align: center;
      margin-bottom: 8px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 16px;
    }

    .field {
      flex: 1;
      min-width: 200px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-bottom: 4px;
    }

    input, select {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--cinza);
      border-radius: 6px;
      font-size: 14px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 24px;
    }

    th, td {
      padding: 8px;
      border: 1px solid var(--cinza);
    }

    th {
      background: var(--cinza-claro);
      text-align: left;
    }

    button {
      display: inline-block;
      padding: 10px 20px;
      background-color: var(--cinza-escuro);
      color: var(--branco);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background-color: #111;
    }

    .status-message {
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
    }

    .status-ok { color: green; }
    .status-error { color: red; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Contagem de Material</h1>
    <h2>Grupo Coqueiro Verde</h2>

    <form id="formContagem">
      <div class="row">
        <div class="field">
          <label>Unidade</label>
          <select name="unidade" required>
            <option value="" disabled selected>Selecione</option>
            <option value="P10">P10</option>
            <option value="P14">P14</option>
          </select>
        </div>
        <div class="field">
          <label>Responsável</label>
          <input type="text" name="responsavel" required>
        </div>
      </div>

      <!-- Seções por categoria -->
      <div id="categorias"></div>

      <h3>Itens não listados</h3>
      <table>
        <tr><th>Item</th><th>Qtd</th></tr>
        <tr><td><input name="extra_item1" type="text"></td><td><input name="extra_qtd1" type="number" min="0"></td></tr>
        <tr><td><input name="extra_item2" type="text"></td><td><input name="extra_qtd2" type="number" min="0"></td></tr>
        <tr><td><input name="extra_item3" type="text"></td><td><input name="extra_qtd3" type="number" min="0"></td></tr>
      </table>

      <div style="text-align: center;">
        <button type="submit" id="btnEnviar">Enviar contagem</button>
        <a href="https://script.google.com/macros/s/AKfycbzld5WBl5h_X_r8ajDAK3hjCiKcK346k1v7N3ZawLgSOYjdB0rlFq7qG8_NGvI0yJYPKQ/exec?pdf=1" target="_blank" style="margin-left: 10px;">
          <button type="button">Clique aqui para baixar PDF profissional</button>
        </a>
      </div>

      <div id="status" class="status-message"></div>
    </form>
  </div>

  <script>
    const categorias = {
      "Copos": ["Copo Americano", "Copo Avulso", "Copo Caipirinha", "Copo Decoração", "Copo Suco"],
      "Talheres": ["Garfo", "Faca", "Colher", "Colher Sobremesa"],
      "Pratos": ["Prato Branco Grande", "Prato Branco Pequeno", "Prato Marrom"],
      "Taças": ["Taça Cerveja", "Taça Champagne", "Taça Gin", "Taça Licor", "Taça Vinho", "Taça Sobremesa"],
      "Outros": ["Dispenser Guardanapo", "Caneca Pequena", "Pires Grande", "Pires Pequeno", "Xícara Grande", "Xícara Pequena", "Jarra 1 L", "Jarra 1/2 L", "Garrafa Tempero", "Garrafa Manteguinha"]
    };

    const container = document.getElementById("categorias");

    for (const [categoria, itens] of Object.entries(categorias)) {
      const section = document.createElement("section");
      section.innerHTML = `<h3>${categoria}</h3><table><tr><th>Item</th><th>Qtd</th></tr></table>`;
      const tabela = section.querySelector("table");

      itens.forEach(item => {
        const nomeCampo = item.toLowerCase().replace(/[\s\/]/g, "_");
        const linha = document.createElement("tr");
        linha.innerHTML = `<td>${item}</td><td><input name="${nomeCampo}_qtd" type="number" min="0" required></td>`;
        tabela.appendChild(linha);
      });

      container.appendChild(section);
    }

    const form = document.getElementById('formContagem');
    const statusEl = document.getElementById('status');
    const btnEnviar = document.getElementById('btnEnviar');
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzld5WBl5h_X_r8ajDAK3hjCiKcK346k1v7N3ZawLgSOYjdB0rlFq7qG8_NGvI0yJYPKQ/exec';

    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      const data = {};
      const fields = form.querySelectorAll('[name]');
      fields.forEach(el => data[el.name] = el.value);

      data.timestamp_cliente = new Date().toISOString();

      btnEnviar.disabled = true;
      btnEnviar.textContent = "Enviando…";
      statusEl.textContent = '';
      statusEl.className = 'status-message';

      try {
        await fetch(WEB_APP_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        statusEl.textContent = "Contagem enviada com sucesso!";
        statusEl.className = "status-message status-ok";
        form.reset();

      } catch (err) {
        statusEl.textContent = "Erro ao enviar os dados.";
        statusEl.className = "status-message status-error";
      }

      btnEnviar.disabled = false;
      btnEnviar.textContent = "Enviar contagem";
    });
  </script>
</body>
</html>
